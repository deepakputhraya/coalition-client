/******/!function(e){function n(o){if(t[o])return t[o].exports;var a=t[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}// webpackBootstrap
/******/
var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";var o=t(1),a=t(2),s=t(3),i=t(4),c=t(5),r=t(6),l=t(7),u=t(8),p=t(9);angular.module("web",["ngResource","ngRoute"]).constant("malarkey",malarkey).constant("moment",moment).constant("autobahn",autobahn).constant("paper",paper).constant("routerIp","54.191.219.106:8080").constant("server","54.191.219.106:5000").config(o.config).config(a.routerConfig).run(s.runBlock).service("channel",r.ChannelService).controller("MainController",i.MainController).controller("ChannelController",c.ChannelController).directive("customCanvas",u.CanvasDirective).directive("chatMessage",l.ChatMessageDirective).directive("page404",p.page404Directive).filter("sanitize",["$sce",function(e){return function(n){return e.trustAsHtml(n)}}])},function(e,n){"use strict";function t(e){"ngInject";e.debugEnabled(!0)}t.$inject=["$logProvider"],Object.defineProperty(n,"__esModule",{value:!0}),n.config=t},function(e,n){"use strict";function t(e){"ngInject";e.when("/",{templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}).when("/:channelId",{templateUrl:"app/channel/channel.html",controller:"ChannelController",controllerAs:"channel"}).otherwise({redirectTo:"/"})}t.$inject=["$routeProvider"],Object.defineProperty(n,"__esModule",{value:!0}),n.routerConfig=t},function(e,n){"use strict";function t(e){"ngInject";e.debug("runBlock end")}t.$inject=["$log"],Object.defineProperty(n,"__esModule",{value:!0}),n.runBlock=t},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),a=function(){function e(n,o,a){"ngInject";t(this,e),this.awesomeThings=[],this.classAnimation="",this.creationDate=1457971579693,n.connect().then(function(e){console.log(e),n.create(e).then(function(e){console.log("Create channel :",e),n.setCreateChannelId(e),o.path("/"+e),a.$apply()},function(e){console.log(e)})})}return e.$inject=["channel","$location","$scope"],o(e,[{key:"startChat",value:function(){console.log("starting new chat...")}}]),e}();n.MainController=a},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),a=function(){function e(n,o,a,s,i,c){"ngInject";var r=this;t(this,e);var l=this;this.scope=o,this.compile=n,this.sce=a,this.channel=i,this.moment=c,this.channelName=s.current.params.channelId,this.existance=!0,this.username=null,this.message={},this.text="",i.connect().then(function(e){console.log(e),o.session=e,i.check(e,r.channelName).then(function(e){if(e.status||l.channelName===i.getCreatedChannelId()){for(;!l.username;)l.username=window.prompt("Enter your name:");return i.setUsername(l.username),e}throw l.existance=!1,{message:"The channel does not exists"}}).then(function(){return i.subscribe(e,r.channelName,function(e){l.onMessageReceive(e)})}).then(function(e){return console.log(e.id),i.previousMessages(e.id).then(function(e){console.log(e),l.messages=e,e.forEach(function(e){l.onMessageReceive(e)})}),i.previousCanvas(e.id).then(function(e){console.log(e),l.canvas=e,e.forEach(function(e){i.canvasEventHandler(e)})}),e}).then(function(e){console.log(e.topic),console.log("Subscription Id:",e.id),console.log("Session Id:",o.session._id),i.setSubscriptionId(e.id),l.data=i.data,r.channel.addPerson({join:l.username,id:o.session._id}),i.publish({join:l.username,id:o.session._id}),o.$apply()})["catch"](function(e){o.$apply(),console.log(e)})})}return e.$inject=["$compile","$scope","$sce","$route","channel","moment"],o(e,[{key:"onMessageReceive",value:function(e){e.join&&this.channel.addPerson(e);var n=null,t=null;e.body&&(e.time=e.time||this.moment().format("LLL"),e.body=e.body.replace("\n","</p><p>").replace(" ","&nbsp;"),e.body=["<p>",e.body,"</p>"].join("")),t=angular.element("<chat-message message='"+JSON.stringify(e)+"'></chat-message>"),n=this.compile(t)(this.scope),angular.element(document.querySelector(".messages-container")).append(n)}},{key:"sendMessage",value:function(){this.text=this.text.trim();var e={username:this.username,body:this.text,time:this.moment().format("LLL")};this.channel.publish(e),e.body=e.body.split("\n").join("</p><p>").replace(" ","&nbsp;"),e.body=["<p>",e.body,"</p>"].join("");var n=angular.element("<chat-message message='"+JSON.stringify(e)+"'></chat-message>"),t=this.compile(n)(this.scope);angular.element(document.querySelector(".messages-container")).append(t),this.text=""}},{key:"keyup",value:function(e){13===e.keyCode&&!e.shiftKey&&this.text.trim()&&this.sendMessage()}}]),e}();n.ChannelController=a},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),a=function(){function e(n,o,a,s){"ngInject";t(this,e),this.http=n,this.autobahn=o,this.routerIp=a,this.server=s,this.username=null,this.createChannelId=null,this.subscriptionId=null,this.people=[],this.peopleCount=0,this.data={username:null,peopleCount:0},this.canvasEventHandler=null}return e.$inject=["$http","autobahn","routerIp","server"],o(e,[{key:"connect",value:function(){var e=this;return console.log("connect!"),new Promise(function(n){if(e.session)return n(e.session);var t="ws://"+e.routerIp+"/ws",o=new e.autobahn.Connection({url:t,realm:"realm1"});o.onopen=function(t){console.log("connected"),e.session=t,n(t)},o.open(),console.log(o.isConnected),o.onclose=function(){console.log("closed!")}})}},{key:"previousMessages",value:function(e){var n=this;return new Promise(function(t,o){n.http.get("http://"+n.server+"/channel/messages/"+e).then(function(e){t(e.data.messages)})["catch"](function(e){o(e)})})}},{key:"previousCanvas",value:function(e){var n=this;return new Promise(function(t,o){n.http.get("http://"+n.server+"/channel/canvas/"+e).then(function(e){t(e.data.canvas)})["catch"](function(e){o(e)})})}},{key:"create",value:function(e){return new Promise(function(n,t){e.call("channel.create",[]).then(function(e){n(e)},function(e){t(e)})})}},{key:"check",value:function(e,n){return new Promise(function(t,o){e.call("channel.join",[],{channelId:n}).then(function(e){t(e)},function(e){o(e)})})}},{key:"subscribe",value:function(e,n,t){var o=this;return new Promise(function(a,s){e.subscribe(n,function(e,n){return n.canvas?o.canvasEventHandler(n):void t(n)}).then(function(n){o.topic=n.topic,e.subscribe("wamp.subscription.on_unsubscribe",function(e){var n=e[0],a=e[1];if(o.subscriptionId===a){var s=-1;o.people.forEach(function(e,a){e.id===n&&(s=a,o.data.peopleCount=o.data.peopleCount-1,t({leave:e.join}))}),s>=0&&(o.people.splice(s,1),console.log(o.people))}}),e.call(n.topic+".people",[]).then(function(e){console.log(e),o.people=o.people.concat(e),o.data.peopleCount=o.people.length,a(n)},function(e){console.log(e),a(n)}),e.register(n.topic+".people",function(){return o.people},{invoke:"first"}).then(function(e){console.log("registered ",e.procedure)},function(e){console.log("failed to register procedure: "+e)})},function(e){console.log(e),s(e)})})}},{key:"publish",value:function(e){this.session.publish(this.topic,[],e)}},{key:"publishCanvas",value:function(e){e.canvas=e.canvas?e.canvas:!0,this.session.publish(this.topic,[],e)}},{key:"setCreateChannelId",value:function(e){this.createChannelId=e}},{key:"getCreatedChannelId",value:function(){return this.createChannelId}},{key:"setSubscriptionId",value:function(e){this.subscriptionId=e}},{key:"addPerson",value:function(e){this.people.push(e),this.data.peopleCount=this.data.peopleCount+1}},{key:"getPeople",value:function(){return this.people}},{key:"setUsername",value:function(e){this.data.username=e}},{key:"setCanvasEventHandler",value:function(e){this.canvasEventHandler=e}}]),e}();n.ChannelService=a},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(){"ngInject";var e={restrict:"E",scope:{message:"="},templateUrl:"app/components/message/message.html",controller:a,controllerAs:"vm",bindToController:!0};return e}Object.defineProperty(n,"__esModule",{value:!0}),n.ChatMessageDirective=o;var a=function s(){"ngInject";t(this,s),console.log(this.message)}},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(){"ngInject";var e={restrict:"AE",templateUrl:"app/components/canvas/canvas.html",controller:s,controllerAs:"vm",bindToController:!0};return e}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();n.CanvasDirective=o;var s=function(){function e(n,o,a){"ngInject";t(this,e);var s=this;this.paper=n,this.data=a.data;var i=document.getElementById("myCanvas");n.setup(i);var c,r=[],l=new n.Tool;this.settings={color:"red",width:5},l.onMouseDrag=function(e){c.add(e.point),r.push([e.point.x,e.point.y])},l.onMouseDown=function(e){c=new n.Path,c.strokeColor=s.settings.color?s.settings.color:"black",c.strokeWidth=s.settings.width?s.settings.width:1,c.add(e.point),r.push([e.point.x,e.point.y])},l.onMouseUp=function(){a.publishCanvas({username:s.data.username,segments:r,width:s.settings.width,color:s.settings.color}),r=[]},this.onCanvasActivity=function(e){new s.paper.Path({segments:e.segments,strokeWidth:e.width,strokeColor:e.color})},a.setCanvasEventHandler(s.onCanvasActivity)}return e.$inject=["paper","$scope","channel"],a(e,[{key:"clearCanvas",value:function(){this.paper.project.clear()}}]),e}()},function(e,n){"use strict";function t(){"ngInject";var e={restrict:"AE",templateUrl:"app/components/404/404.html",bindToController:!0};return e}Object.defineProperty(n,"__esModule",{value:!0}),n.page404Directive=t}]),angular.module("web").run(["$templateCache",function(e){e.put("app/channel/channel.html",'<div class="container-fluid" ng-show="channel.username"><div class="col-md-3 chat-container"><div class="channel-head row"><h1>Coalition</h1><h3>{{channel.username}} {{channel.data.peopleCount}}</h3></div><div class="messages-container row"></div><div class="message-input row"><div class="input-group input-group-lg"><textarea ng-model="channel.text" ng-keyup="$event.keyCode == 13? channel.keyup($event) : \'\'" name="name" rows="2" cols="40" class="form-control"></textarea><span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="channel.sendMessage()"><span class="glyphicon glyphicon-send" aria-hidden="true"></span></button></span></div></div></div><div class="col-md-9 canvas-cotainer"><custom-canvas></custom-canvas></div></div><page404 ng-show="!channel.existance"></page404>'),e.put("app/main/main.html",'<div class="container-fluid"></div>'),e.put("app/components/404/404.html",'<div style="width: 375px; height: 300px; margin: auto;"><svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewbox="0 0 750 600"><rect rx="37.5" ry="37.5" height="600" width="750" y="0" x="0"></rect><path fill="#fff" d="m375 31.25c-58.47 0-108.7 8.625-163.12 40.045-54.22 31.305-107.07 47.885-180.63 47.885v316.94c0 28.16 0.055 28.17 18.533 42.41 32.287 24.88 325.22 90.22 325.22 90.22s292.93-65.34 325.22-90.22c18.48-14.24 18.53-14.25 18.53-42.41v-316.94c-73.56 0-126.41-16.58-180.63-47.885-54.42-31.42-104.64-40.045-163.12-40.045z"></path><path d="m222.91 360.52v60.16h-37.82v-60.16h-119.6l0.003-22.7 119.6-158.5h37.82v146.62h23.06v34.58h-23.06zm-37.82-125.36l-68.81 90.78h68.81v-90.78zm284.83 65.2c0 19.21-2.28 37.59-6.85 55.12-4.56 17.53-11.04 31.7-19.45 42.51-13.45 18.01-32.9 27.01-58.35 27.01-17.06 0-31.11-3.48-42.15-10.44-11.05-6.97-20.17-17.89-27.37-32.79-5.05-10.32-9.13-22.87-12.25-37.64-3.12-14.76-4.68-29.36-4.68-43.77 0-19.93 2.34-38.42 7.02-55.47s11.11-31.34 19.27-42.87c7.21-9.12 15.79-15.91 25.76-20.35 9.97-4.45 21.91-6.67 35.84-6.67 15.37 0 28.45 3.48 39.26 10.45s20.05 17.89 27.74 32.78c5.04 10.81 9.01 23.42 11.89 37.82 2.88 14.41 4.32 29.18 4.32 44.31zm-38.18 0c0-13.69-1.2-26.35-3.6-38s-6.01-21.56-10.82-29.72c-3.84-6.25-8.22-10.81-13.14-13.69s-10.98-4.56-18.19-5.04c-9.36-0.48-17.17 1.68-23.41 6.48-6.25 4.8-11.41 12.61-15.49 23.42-3.12 7.2-5.47 15.91-7.03 26.11-1.56 10.21-2.34 20.35-2.34 30.44 0 12.97 1.2 25.46 3.6 37.47s6 21.85 10.8 29.53c3.85 6.25 8.41 10.93 13.7 14.05 5.28 3.12 11.76 4.68 19.45 4.68 8.88 0 16.26-2.4 22.15-7.2 5.88-4.8 10.87-12.6 14.95-23.41 1.2-3.12 2.4-6.91 3.61-11.35 1.2-4.44 2.22-9.12 3.06-14.05 0.84-4.92 1.5-9.91 1.98-14.95s0.72-9.96 0.72-14.77zm225.27 60.16v60.16h-37.81v-60.16h-119.6v-22.7l119.6-158.5h37.81v146.62h23.07v34.58h-23.07zm-37.81-125.36l-68.81 90.78h68.81v-90.78z"></path></svg></div>'),e.put("app/components/canvas/canvas.html",'<canvas id="myCanvas"></canvas>'),e.put("app/components/message/message.html",'<div class="chat-message"><div class="media-body"><div class="media-body" ng-if="vm.message.body? true: false"><big class="text-"><strong>{{vm.message.username}} :</strong></big><p ng-bind-html="vm.message.body | sanitize"></p><small class="text-muted">{{vm.message.time}}</small><br><hr></div><p style="text-align:center; padding-top: 10px" ng-if="vm.message.join? true: false"><mark>{{vm.message.join}} joined</mark></p><p style="text-align:center; padding-top: 10px" ng-if="vm.message.leave? true: false"><mark>{{vm.message.leave}} left</mark></p></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-11d530ee1f.js.map
